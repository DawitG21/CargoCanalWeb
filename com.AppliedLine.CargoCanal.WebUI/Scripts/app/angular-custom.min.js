var app=angular.module("app",["localization","ngAnimate","ui.router","ui.bootstrap","ngStorage","ngSanitize","chartjsAngular","ngFileUpload","ngImgCrop"]),serverUrl,api;app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(n,t,i){i.hashPrefix("");i.html5Mode(!0);t.otherwise("/home");n.state("home",{url:"/home",templateUrl:"views/home.html",controller:"mainCtrl"});n.state("passwordreset",{url:"/account/reset-password",templateUrl:"views/admin/passwordreset.html",controller:"passwordCtrl"});n.state("passwordreset.changepassword",{url:"/change-password",templateUrl:"views/admin/passwordreset_changepassword.html"});n.state("termsofservice",{url:"/terms-of-service",templateUrl:"views/terms_of_service.html"});n.state("privacypolicy",{url:"/privacy-policy",templateUrl:"views/privacy_policy.html"});n.state("report",{url:"/report",templateUrl:"views/reports/report.html",controller:"reportController"});n.state("customreport",{url:"/customreport",templateUrl:"templates_quarantined/report/dashboard-customreports.html",controller:"reportCustomCtrl"});n.state("report.cargo_dispatched_weight_grouped_by_month_report",{url:"/001",templateUrl:"views/reports/cargo_dispatched_weight_grouped_by_month.html"});n.state("report.cargo_import_weight_grouped_by_tin_report",{url:"/002",templateUrl:"views/reports/cargo_import_weight_grouped_by_tin.html"});n.state("report.cargo_on_voyage_only_grouped_by_country_report",{url:"/003",templateUrl:"views/reports/cargo_on_voyage_only_grouped_by_country.html"});n.state("report.problem_grouped_by_tin_report",{url:"/004",templateUrl:"views/reports/problem_grouped_by_tin.html"});n.state("report.problem_grouped_by_tin_unresolved_report",{url:"/005",templateUrl:"views/reports/problem_grouped_by_tin_unresolved.html"});n.state("report.demurrage_grouped_by_tin_report",{url:"/006",templateUrl:"views/reports/demurrage_grouped_by_tin.html"});n.state("report.demurrage_grouped_by_tin_active_report",{url:"/007",templateUrl:"views/reports/demurrage_grouped_by_tin_active.html"});n.state("report.transit_time_grouped_by_import_report",{url:"/008",templateUrl:"views/reports/transit_time_grouped_by_import.html"});n.state("report.transit_time_grouped_by_country_report",{url:"/009",templateUrl:"views/reports/transit_time_grouped_by_country.html"});n.state("report.transit_time_grouped_by_country_summary_report",{url:"/010",templateUrl:"views/reports/transit_time_grouped_by_country_summary.html"});n.state("report.transit_time_grouped_by_tin_report",{url:"/011",templateUrl:"views/reports/transit_time_grouped_by_tin.html"});n.state("report.bill_statuses_grouped_by_tin_report",{url:"/012",templateUrl:"views/reports/bill_statuses_grouped_by_tin.html"});n.state("dashboard",{url:"/dashboard",templateUrl:"views/dashboard.html",controller:"dashboardController"});n.state("account",{url:"/account",templateUrl:"views/account.html",controller:"accountCtrl"});n.state("account.uploadprofileimage",{url:"/upi",templateUrl:"views/account_upload_profile_image.html"});n.state("account.subscriptions",{url:"/subscriptions",templateUrl:"views/account_subscriptions.html"});n.state("account.users",{url:"/users",templateUrl:"views/account_users.html",controller:"adminCtrl"});n.state("account.company",{url:"/company",templateUrl:"views/account_company.html",controller:"adminCtrl"});n.state("login",{url:"/login",templateUrl:"views/login.html",controller:"loginController"});n.state("register",{url:"/register",templateUrl:"views/admin/create_company.html",controller:"createConsigneeCtrl"});n.state("maritime",{url:"/mt",templateUrl:"views/admin/maritime.html",controller:"maritimeController"});n.state("maritime.import",{url:"/import",templateUrl:"views/import/import_maritime.html",controller:"importController"});n.state("maritime.export",{url:"/export",templateUrl:"views/export/export_maritime.html",controller:"exportController"});n.state("maritime.createcompany",{url:"/create/company",templateUrl:"views/admin/create_company.html"});n.state("import",{url:"/import",templateUrl:"views/import/import.html",controller:"importController"});n.state("import.add",{url:"/a",templateUrl:"views/import/add_consignee.html"});n.state("import.add.bill",{url:"/bill",templateUrl:"views/import/add_bill.html"});n.state("import.add.items",{url:"/items",templateUrl:"views/import/add_items.html"});n.state("import.add.carrier",{url:"/carrier",templateUrl:"views/import/add_carrier.html"});n.state("export",{url:"/export",templateUrl:"views/export/export.html",controller:"exportController"});n.state("export.add",{url:"/a",templateUrl:"views/export/add_consignee.html"});n.state("export.add.bill",{url:"/bill",templateUrl:"views/export/add_bill.html"});n.state("export.add.bill2",{url:"/stuffloc",templateUrl:"views/export/add_bill2.html"});n.state("export.add.items",{url:"/items",templateUrl:"views/export/add_items.html"});n.state("export.add.carrier",{url:"/carrier",templateUrl:"views/export/add_carrier.html"})}]),function(){"use strict";app.service("refresher",["$sessionStorage","$rootScope",function(n,t){this.refreshApp=function(){n.__user===undefined||(t.User=n.__user)};this.refreshApp()}]);app.factory("autoCompleteDataService",["$http",function(){return{getSource:function(n,t){return function(i,r){$.ajax({url:api+"/"+n,dataType:"json",data:{term:i.term,extraparams:t},success:function(n){r(n)}})}}}}]);app.factory("passwordFactory",["$rootScope","$http",function(n,t){var i={};return i.change=function(n){return t({method:"PUT",url:api+"/account/passwordresetchange",data:n,headers:{"Content-Type":"application/json"}}).then(function(n){return n},function(n){return n})},i.checklink=function(n){return t({method:"POST",url:api+"/account/passwordresetcheck",data:n,headers:{"Content-Type":"application/json"}}).then(function(n){return n},function(n){return n})},i.reset=function(n){return t({method:"POST",url:api+"/account/passwordreset",data:n,headers:{"Content-Type":"application/json"}}).then(function(n){return n},function(n){return n})},i.validate=function(n){return/[\S]{6,32}/.test(n)&&/[A-Z]/.test(n)&&/[a-z]/.test(n)&&/[0-9]/.test(n)&&/[ !"#$%&'()*+,\-./:;<=>?@^]/.test(n)?!0:!1},n.validatePassword=function(n,t){let r=t.$$element[0].className.includes("textbox-editor")?" textbox-editor":"";i.validate(n)?(t.$error={},t.$invalid=!1,t.$valid=!0,t.$$element[0].className="form-control ng-not-empty ng-dirty ng-valid-parse ng-valid ng-valid-required ng-touched"+r):(t.$error={pattern:!0},t.$invalid=!0,t.$valid=!1,t.$$element[0].className="form-control ng-not-empty ng-dirty ng-valid-parse ng-valid ng-valid-required ng-touched ng-invalid"+r)},i}]);app.factory("appFactory",["$rootScope","$state","$http","$q","$sce",function(n,t,i,r,u){n.modalOpen=!1;var e=!0,f={},o=api.substring(0,api.indexOf("/api"))+"/odata";f.setModalOpen=function(t){n.modalOpen=t};f.getRgbArray=function(n){const r=[],u=[],i=255,t=1;for(let f=0;f<n;f++){const n=Math.floor(Math.random()*(i-t))+t,f=Math.floor(Math.random()*(i-t))+t,e=Math.floor(Math.random()*(i-t))+t;r.push("rgb("+n+","+f+","+e+")");u.push("rgba("+n+","+f+","+e+", 0.4)")}return{rgb:r,rgbaOpaque:u}};let s=function(){n.modalOpenClass=function(){return n.modalOpen?"fullscreen-open":""};n.closeDialog=function(){f.setModalOpen(!1);n.showDialog=!1;n.confirmMode=!1};n.trustEntryAsHtml=function(n){return u.trustAsHtml(n)};n.getPols=function(t,r){r.PortOfLoadingID=undefined;i({method:"GET",url:api+"/values/getports/"+t,headers:{"Content-Type":"application/json"}}).then(function(t){n.pols=t.data})};n.getPods=function(t,r){r.PortOfDischargeID=undefined;i({method:"GET",url:api+"/values/getports/"+t,headers:{"Content-Type":"application/json"}}).then(function(t){n.pods=t.data})};n.getSubCargos=function(t,r){r.SubCargoID=undefined;i({method:"GET",url:api+"/values/getsubcargos/"+t,headers:{"Content-Type":"application/json"}}).then(function(t){n.cargoSubCargos=t.data})};n.optionsMore={openWindow:!1,show:function(t,i){n.record=t;n.recordIndex=i;n.optionsMore.openWindow=!0;f.setModalOpen(!0)},closeWindow:function(){n.optionsMore.openWindow=!1;f.setModalOpen(!1);n.record=undefined;n.recordIndex=undefined}};n.status={openWindow:!1,showFilters:!1,closeWindow:function(){n.status.openWindow=!1;f.setModalOpen(!1)},data:[],getStatuses:function(t){n.status.data=[];n.status.openWindow=!0;f.setModalOpen(!0);n.status.importExport=t;n.status.data=t.StatusesViews}};n.problem={openWindow:!1,showFilters:!1,closeWindow:function(){n.problem.openWindow=!1;f.setModalOpen(!1)},data:[],getProblems:function(t){n.problem.data=[];n.problem.openWindow=!0;f.setModalOpen(!0);n.problem.importExport=t;i({method:"GET",url:api+"/importexport/getproblemupdates/"+t.ID,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(t){n.problem.data=t.data})}};n.preview={"export":{openWindow:!1,data:{},show:function(t){(t.Documents===undefined||t.Documents===null)&&f.getImportExportDocs(t.ID).then(function(n){n.status===200&&(t.Documents=n.data)});n.preview.export.data=t;n.preview.export.openWindow=!0;f.setModalOpen(!0)},closeWindow:function(){n.preview.export.data={};n.preview.export.openWindow=!1;f.setModalOpen(!1)}},"import":{openWindow:!1,data:{},show:function(t){(t.Documents===undefined||t.Documents===null)&&f.getImportExportDocs(t.ID).then(function(n){n.status===200&&(t.Documents=n.data)});n.preview.import.data=t;n.preview.import.openWindow=!0;f.setModalOpen(!0)},closeWindow:function(){n.preview.import.data={};n.preview.import.openWindow=!1;f.setModalOpen(!1)}}}};return f.showDialog=function(t,i,r,u){if(t=i===!0?'<p class="text-danger">'+t+"<\/p>":"<p>"+t+"<\/p>",n.showDialog===!0){n.dialogMsg+=t;return}n.dialogMsg=t;n.showDialog=!0;f.setModalOpen(!0);n.confirmMode=r;r&&(n.confirmDialog=u)},f.setDataImage=function(){switch(n.User.Person.Photo){case null:case undefined:case"":break;default:n.User.Person.PhotoDataUrl="data:image/jpg;base64,"+n.User.Person.Photo}},f.getActiveIcon=function(n){return n?"status-icon-green":"status-icon-red"},f.getCargos=function(){(n.cargos===undefined||n.cargos.length===0)&&i({method:"GET",url:api+"/values/getcargo?id",headers:{"Content-Type":"application/json"}}).then(function(t){n.cargos=t.data})},f.getUnits=function(){(n.units===undefined||n.units.length===0)&&i({method:"GET",url:api+"/values/getunit?id",headers:{"Content-Type":"application/json"}}).then(function(t){n.units=t.data})},f.getCountries=function(){(n.countries===undefined||n.countries.length===0)&&i({method:"GET",url:api+"/values/getcountry?id",headers:{"Content-Type":"application/json"}}).then(function(t){n.countries=t.data})},f.getCompanyTypes=function(){(n.companyTypes===undefined||n.companyTypes.length===0)&&i({method:"GET",url:api+"/values/getcompanytype?id",headers:{"Content-Type":"application/json"}}).then(function(t){n.companyTypes=t.data})},f.getMots=function(){(n.mots===undefined||n.mots.length===0)&&i({method:"GET",url:api+"/values/getmodeOftransport?id",headers:{"Content-Type":"application/json"}}).then(function(t){n.mots=t.data})},f.getCarriers=function(){(n.carriers===undefined||n.carriers.length===0)&&i({method:"GET",url:api+"/values/getcarrier?id",headers:{"Content-Type":"application/json"}}).then(function(t){n.carriers=t.data})},f.getImportExportReasons=function(){(n.importExportReasons===undefined||n.importExportReasons.length===0)&&i({method:"GET",url:api+"/values/getimportexportreason",headers:{"Content-Type":"application/json"}}).then(function(t){n.importExportReasons=t.data})},f.getIncoTerms=function(){(n.incoTerms===undefined||n.incoTerms.length===0)&&i({method:"GET",url:api+"/values/getincoterm?id",headers:{"Content-Type":"application/json"}}).then(function(t){n.incoTerms=t.data})},f.getLocations=function(t){(n.locations===undefined||n.locations.length===0)&&i({method:"GET",url:api+"/values/getlocations/"+t,headers:{"Content-Type":"application/json"}}).then(function(t){n.locations=t.data})},f.getProblems=function(){(n.problems===undefined||n.problems.length===0)&&i({method:"GET",url:api+"/values/getproblem?id",headers:{"Content-Type":"application/json"}}).then(function(t){n.problems=t.data})},f.loadStatuses=function(){(n.statuses===undefined||n.statuses.length===0)&&i({method:"GET",url:api+"/values/getstatus?id",headers:{"Content-Type":"application/json"}}).then(function(t){n.statuses=t.data})},f.getStuffModes=function(){(n.stuffModes===undefined||n.stuffModes.length===0)&&i({method:"GET",url:api+"/values/getstuffmode?id",headers:{"Content-Type":"application/json"}}).then(function(t){n.stuffModes=t.data})},f.validateTin=function(n,i){n===""||n===null||n===undefined?(e=!0,i!==""&&t.go(i)):f.getCompanyByTin(n).then(function(n){e=n===null||n===undefined?!1:!0;e&&i!==""&&t.go(i)})},f.getSubscriptionTypes=function(){i({method:"GET",url:api+"/account/getsubscriptiontypes",headers:{"Content-Type":"application/json"}}).then(function(t){n.subscriptionTypes=t.data},function(){n.subscriptionTypes=[]})},f.getCompanySubscriptions=function(n){return i({method:"GET",url:api+"/account/getsubscriptionscurrent/"+n,headers:{"Content-Type":"application/json"}}).then(function(n){return n.data},function(){return[]})},f.setCompanySubscriptions=function(n){return i({method:"POST",url:api+"/account/subscribe/",data:n,headers:{"Content-Type":"application/json"}}).then(function(n){return n},function(){return null})},f.getIsTinValid=function(){return e},f.setIsTinValid=function(n){e=n},f.getImportExportDocs=function(n){return i({method:"GET",url:api+"/importexport/getimportexportdocs?id="+n,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(n){return n},function(n){return n})},f.getCompanyByTin=function(n){return i({method:"GET",url:api+"/values/validatetin?tin="+n,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(n){return n.data},function(){return null})},f.getExRate=function(){return $.getJSON("https://openexchangerates.org/api/latest.json",{app_id:"d6c5e9e7c538400b9c0ff657a1229810"},function(t){n.exRates={base:t.base,timestamp:t.timestamp,rates:[]};for(var i in t.rates)n.exRates.rates.push({Currency:i,Rate:t.rates[i]})})},f.saveCostInfo=function(n){var t="POST",r="/importexport/postcost";return!isNaN(n.ID)&&n.ID>0&&(t="PUT",r="/importexport/putcost"),i({method:t,url:api+r,data:n,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(n){return n.data},function(){return null})},f.prepCards=function(){setTimeout(function(){let t=document.getElementById("cardsjs");t!==undefined&&t.parentNode.removeChild(t);let n=document.createElement("script");n.id="cardsjs";n.src="src/lib/cards.min.js";n.async=!1;document.body.appendChild(n)},1500)},f.saveLc=function(n){return i({method:"PUT",url:api+"/importexport/putlc",data:n,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(n){return n},function(){return null})},f.linkTinToBill=function(n){return i({method:"PUT",url:api+"/importexport/putconsigneetin",data:n,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(n){return n.data},function(){return null})},f.getImports=function(t,r,u,f){(f===undefined||f===null||f==="")&&(f="?$orderby=ID desc&$inlinecount=allpages&$expand=LC,Consignee,Items/ItemDetails,Cost");let e="",s={};switch(u){case undefined:case"":e=o+"/ODataImport("+n.User.Company.ID+")/GetImports"+f;s={skip:t};break;default:e=o+"/ODataImport("+n.User.Company.ID+")/SearchImports"+f;s={skip:t,searchText:u,token:n.User.Login.Token}}return i({method:"POST",url:e,headers:{"Content-Type":"application/json; charset=utf-8"},data:s}).then(function(n){return{value:r.concat(n.data.value),odataInfo:{"odata.metadata":n.data["odata.metadata"],"odata.count":n.data["odata.count"],"odata.nextLink":n.data["odata.nextLink"]}}},function(){return null})},f.getExports=function(t,r,u,f){(f===undefined||f===null||f==="")&&(f="?$orderby=ID desc&$inlinecount=allpages&$expand=LC,Consignee,Items/ItemDetails,Cost");let e="",s={};switch(u){case undefined:case"":e=o+"/ODataExport("+n.User.Company.ID+")/GetExports"+f;s={skip:t};break;default:e=o+"/ODataExport("+n.User.Company.ID+")/SearchExports"+f;s={skip:t,searchText:u,token:n.User.Login.Token}}return i({method:"POST",url:e,headers:{"Content-Type":"application/json; charset=utf-8"},data:s}).then(function(n){return{value:r.concat(n.data.value),odataInfo:{"odata.metadata":n.data["odata.metadata"],"odata.count":n.data["odata.count"],"odata.nextLink":n.data["odata.nextLink"]}}},function(){return null})},f.getImportExportByTinOrLc=function(t,r,u,f){u&&(t=[]);r===undefined&&(r="");(f===undefined||f===null||f==="")&&(f="?$orderby=ID desc&$inlinecount=allpages&$expand=LC,Consignee,Items/ItemDetails,Cost,StatusesViews");let e=o+"/ODataCustomer("+n.User.Company.ID+")/SearchImportExport"+f,s={skip:t.length,searchText:r,token:n.User.Login.Token};return i({method:"POST",url:e,headers:{"Content-Type":"application/json; charset=utf-8"},data:s}).then(function(n){return{value:t.concat(n.data.value),odataInfo:{"odata.metadata":n.data["odata.metadata"],"odata.count":n.data["odata.count"],"odata.nextLink":n.data["odata.nextLink"]}}},function(){return null})},f.searchImport=function(t){var r={};return r.Token=n.User.Login.Token,r.CompanyID=n.User.Company.ID,r.SearchText=t,i({method:"POST",data:r,url:api+"/importexport/searchimports",headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(n){return n.data},function(){return null})},f.searchExport=function(t){var r={};return r.Token=n.User.Login.Token,r.CompanyID=n.User.Company.ID,r.SearchText=t,i({method:"POST",data:r,url:api+"/importexport/searchexports",headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(n){return n.data},function(){return null})},s(),f}]);app.factory("groupByFactory",["$filter",function(n){var t=[],i={};return i.groupByField=function(i,r){return i.length>0&&(t=n("groupByField")(i,r)),t},i}]);app.provider("datepickerProvider",[function(){this.dateOptions={};this.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate","M!/d!/yyyy"];this.disableWeekends=function(n){var t=n.date,i=n.mode;return i==="day"&&(t.getDay()===0||t.getDay()===6)};this.$get=function(){var n=this;return{getFormats:function(){return n.formats},getDateOptions:function(){return n.dateOptions},getDisableWeekends:function(){return n.disableWeekends}}}}]);app.config(["datepickerProviderProvider",function(n){n.dateOptions={datepickerMode:"day",formatYear:"yyyy",showWeeks:!1,dateDisabled:!1,minDate:null,maxDate:new Date,initDate:new Date}}])}(),function(){"use strict";app.factory("signalRHubProxy",["$rootScope",function(n){function t(t,i){var u=$.hubConnection(t),r=u.createHubProxy(i);return u.start().done(function(){}),{on:function(t,i){r.on(t,function(){var t=arguments;n.$apply(function(){i.apply(r,t)})})},off:function(t,i){r.off(t,function(){var t=arguments;n.$apply(function(){i&&i.apply(r,t)})})}}}return t}])}();serverUrl="http://localhost:49931";api=serverUrl+"/api",function(){"use strict";app.controller("mainCtrl",["$scope","$rootScope","$state","$http","$sessionStorage","localize","refresher","appFactory","passwordFactory","signalRHubProxy",function(n,t,i,r,u,f,e,o,s,h){e.refreshApp();t.googleApiKey="AIzaSyCwTw8Tyx3_bPBoZ43MXVDhY7TRnPvXl7Y";t.host=api.substring(0,api.lastIndexOf("/"));n.logout=function(){u.__user=t.User=undefined;i.go("home")};n.regexUrl="https?://[a-zA-Z]+.+\\.[a-zA-Z]{2,}";n.regexEmail="[a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\\.[a-zA-Z]{2,}";n.regexNumber="\\d+";n.regexPhone="\\+?\\d+";n.prepCards=o.prepCards;t.validateTin=function(n,t){o.validateTin(n,t)};t.getIsTinValid=function(){return o.getIsTinValid()};t.setIsTinValid=function(n){o.setIsTinValid(n)};t.closeWindow=function(){t.showWindow=!1;o.setModalOpen(!1)};n.setEnglishLanguage=function(){f.setLanguage("en-US");u.amET=undefined};n.setAmharicLanguage=function(){f.setLanguage("am-ET");u.amET=!0};u.amET?n.setAmharicLanguage():f.initLocalizedResources();var c=h(serverUrl,"accountHub");c.on("toggleUserAccess",function(i){t.User&&t.User.Login.ID===i.ID&&n.logout()});n.getMotIcon=function(n){switch(n.toLowerCase()){case"air":return"common-sprite airplane-32";case"pipe":return"common-sprite pipe-32";case"rail":return"common-sprite railway-32";case"sea":return"common-sprite ship-32";case"truck":return"common-sprite truck-32"}};n.isNotFF=!0;t.refresh=function(){i.reload()}}]);app.controller("passwordCtrl",["$scope","$state","$rootScope","$location","passwordFactory","appFactory",function(n,t,i,r,u,f){(i.User||i.User!==undefined)&&t.go("home");n.queryString=r.search();n.queryString.uid&&n.queryString.usalt&&u.checklink(n.queryString).then(function(i){i.status===200&&(n.passwordReset.data={Url:r.absUrl(),Uid:n.queryString.uid,Usalt:n.queryString.usalt},t.go("passwordreset.changepassword"))});n.passwordReset={data:{},reset:function(){n.passwordReset.data.Url=r.absUrl();n.passwordReset.data.Referrer=n.passwordReset.data.Url.substring(0,n.passwordReset.data.Url.indexOf(r.url()));u.reset(n.passwordReset.data).then(function(){f.showDialog("Check your email for a reset link.");t.go("home")})},changePassword:function(){u.change(n.passwordReset.data).then(function(n){n.status===200?(f.showDialog("Password changed successfully."),t.go("login")):f.showDialog("Password changed failed.",!0)})}}}]);app.controller("loginController",["$scope","$http","$sessionStorage","$rootScope","$state","appFactory",function(n,t,i,r,u,f){n.login={};n.forgotPassword=function(){u.go("passwordreset")};n.signIn=function(){t({method:"POST",url:api+"/account/postlogin",data:n.login,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(n){i.__user=r.User=n.data;f.setDataImage();r.User.Login.LastSeen===null?u.go("account"):u.go("dashboard")},function(){n.loginFailed="Invalid login attempt."})}}]);app.controller("dashboardController",["$scope","$filter","$http","$state","$rootScope","$sessionStorage","chartjsFactory","appFactory",function(n,t,i,r,u,f,e,o){u.User&&u.User!=null||r.go("home");n.dashboard={"import":{data:{},get:function(){i({method:"POST",url:api+"/importexport/dashboardimportsummary",data:u.User.Login,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(t){n.dashboard.import.data=t.data;t.data===null&&(n.dashboard.import.data={},n.dashboard.import.data.Total=0,n.dashboard.import.data.PercentPending=0,n.dashboard.import.data.PercentCompleted=0)})}},"export":{data:{},get:function(){i({method:"POST",url:api+"/importexport/dashboardexportsummary",data:u.User.Login,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(t){n.dashboard.export.data=t.data;t.data===null&&(n.dashboard.export.data={},n.dashboard.export.data.Total=0,n.dashboard.export.data.PercentPending=0,n.dashboard.export.data.PercentCompleted=0)})}},shipments:{data:{},get:function(){i({method:"POST",url:api+"/importexport/dashboardshipmentsanalytics",data:u.User.Login,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(i){var r,u;if(i.data!==null&&i.data!==undefined&&i.data.labels.length!==0){n.dashboard.shipments.data=i.data;n.chartOptions={backgroundColors:["rgba(65, 192, 192, 0.1)","rgba(255, 10, 182, 0.1)","rgba(85, 255, 100, 0.1)","rgba(95, 0, 11, 0.1)"],borderColors:["rgba(65, 192, 192, 1)","rgba(255, 10, 182, 1)","rgba(85, 255, 100, 1)","rgba(95, 0, 11, 1)"]};n.dashboard.shipments.data.datasets=[];for(r in n.dashboard.shipments.data.data)n.dashboard.shipments.data.datasets.push({data:angular.copy(n.dashboard.shipments.data.data[r]),label:n.dashboard.shipments.data.series[r]});n.dashboard.shipments.data.data=undefined;n.dashboard.shipments.data.series=undefined;for(r in n.dashboard.shipments.data.labels)n.dashboard.shipments.data.labels[r]=t("date")(n.dashboard.shipments.data.labels[r],"MMM dd");for(r in n.dashboard.shipments.data.datasets){let t=r%n.chartOptions.borderColors.length;n.dashboard.shipments.data.datasets[r].backgroundColor=n.chartOptions.backgroundColors[t];n.dashboard.shipments.data.datasets[r].borderColor=n.chartOptions.borderColors[t];n.dashboard.shipments.data.datasets[r].lineTension=0}e.setCanvas("canvas1");u=e.createChart("line",n.dashboard.shipments.data,{scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date Inserted"}}],yAxes:[{scaleLabel:{display:!0,labelString:"No. of Cargo"},ticks:{stepSize:5}}]}})}})}},demurrage:{data:{},get:function(){i({method:"POST",url:api+"/importexport/dashboarddemurrageanalytics",data:u.User.Login,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(i){var r,f;if(i.data!==null&&i.data!==undefined&&i.data.labels.length!==0){let u=o.getRgbArray(i.data.datasets.length);n.dashboard.demurrage.data=i.data;n.chartOptions={backgroundColors:["rgba(65, 192, 192, 0.4)","rgba(255, 10, 182, 0.4)","rgba(85, 255, 100, 0.4)","rgba(95, 0, 11, 0.4)"],borderColors:["rgba(65, 192, 192, 1)","rgba(255, 10, 182, 1)","rgba(85, 255, 100, 1)","rgba(95, 0, 11, 1)"]};for(r in n.dashboard.demurrage.data.labels)n.dashboard.demurrage.data.labels[r]=t("date")(n.dashboard.demurrage.data.labels[r],"MMM dd");for(r in n.dashboard.demurrage.data.datasets){let t=r%n.chartOptions.borderColors.length;n.dashboard.demurrage.data.datasets[r].backgroundColor=u.rgbaOpaque[t];n.dashboard.demurrage.data.datasets[r].borderColor=u.rgb[t];n.dashboard.demurrage.data.datasets[r].lineTension=0;n.dashboard.demurrage.data.datasets[r].pointRadius=n.dashboard.demurrage.data.datasets[r].pointHoverRadius=10}e.setCanvas("canvas2");f=e.createChart("line",n.dashboard.demurrage.data,{tooltips:{mode:"label"},scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Cargo Discharged (Date)"}}],yAxes:[{scaleLabel:{display:!0,labelString:"Demurrage (Days)"},ticks:{stepSize:5}}]},legend:{display:!1}})}})}},maps:{data:{}}};n.dashboard.import.get();n.dashboard.export.get();n.dashboard.shipments.get();n.dashboard.demurrage.get();i({method:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?address=ethiopia&key="+u.googleApiKey,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(t){n.dashboard.maps.data=t.data})}]);app.controller("importController",["$scope","$rootScope","$http","$sessionStorage","$state","appFactory","Upload","$timeout","$filter",function(n,t,i,r,u,f,e,o,s){t.User&&t.User!==null||u.go("home");n.impExpType=1;n.startImport=function(){f.getCarriers();f.getCountries();f.getImportExportReasons();f.getIncoTerms();f.getMots()};n.startImport();n.filterCarrier=function(t){if(n.motFilter={ModeOfTransportID:n.newImport.ModeOfTransportID.toString()},t.ModeOfTransportID==="4"||t.ModeOfTransportID==="3"){n.hideCarrier=!0;t.Vessel=undefined;t.CarrierID=undefined;return}n.hideCarrier=!1};n.addNewItem=function(){n.disableAddToItems=!1;t.showWindow=!0;f.setModalOpen(!0);n.newItem={ItemDetails:[]};f.getCargos();f.getUnits();f.getStuffModes();f.getLocations(t.User.Company.CountryID)};n.addNewItemToItems=function(){(n.validateItemDetails(),n.disableAddToItems)||(n.newImport.Items.push(n.newItem),t.closeWindow())};n.initItemDetail=function(){n.newItemDetail={};n.showItemDetailEntry=!0};n.addItemDetailToItem=function(){for(var t in n.newItem.ItemDetails)if(n.newItem.ItemDetails[t].ItemNumber.toLowerCase()===n.newItemDetail.ItemNumber.toLowerCase()){n.itemDetailsMsg='Item detail already contain packing number "'+n.newItemDetail.ItemNumber+'".';n.disableAddToItems=!0;return}n.newItem.ItemDetails.push(n.newItemDetail);n.showItemDetailEntry=!1;n.disableAddToItems&&(n.disableAddToItems=!1)};n.validateItemDetails=function(){if(n.newItem.ItemDetails.length===0){n.disableAddToItems=!0;n.itemDetailsMsg="Item detail information is required.";return}if((n.newItem.CargoID==1||n.newItem.CargoID==4)&&n.newItem.Quantity<21&&n.newItem.Quantity!==n.newItem.ItemDetails.length){n.disableAddToItems=!0;n.itemDetailsMsg="You need to enter "+n.newItem.Quantity+" cargo details.";return}if((n.newItem.CargoID==1||n.newItem.CargoID==4)&&n.newItem.Quantity>20&&n.newImport.Documents.length===0){n.disableAddToItems=!0;n.itemDetailsMsg="You need to enter "+n.newItem.Quantity+" cargo details, otherwise, attach supporting documents.";return}n.disableAddToItems=!1};n.uploadFiles=function(t,i){n.existDocCount=n.newImport.Documents.length;n.files=t;n.errFiles=i;angular.forEach(t,function(t){n.existDocCount==0?(t.upload=e.upload({url:api+"/importexport/postdocument",data:{file:t}}),t.upload.then(function(i){o(function(){t.result=i.data;n.newImport.Documents.push({DocumentID:t.result})})},function(t){t.status>0&&(n.errorMsg=t.status+": "+t.data)},function(n){t.progress=Math.min(100,parseInt(100*n.loaded/n.total))})):n.existDocCount-=1})};n.removeAttachment=function(t){var r=n.files[t];i({method:"DELETE",url:api+"/importexport/deletedocument?id="+r.result});n.files.splice(t,1);n.newImport.Documents.splice(t,1)};n.removeItemDetail=function(t){n.newItem.ItemDetails.splice(t,1)};n.hideItemDetailEntry=function(){n.showItemDetailEntry=!1};n.removeItem=function(t){n.newImport.Items.splice(t,1)};n.initImport=function(){f.setIsTinValid(!0);n.disableButton=!1;n.newImport={CompanyID:t.User.Person.CompanyID,CountryID:t.User.Company.CountryID,CreatedBy:t.User.Person.ID,Import:{},Items:[],LC:{},Documents:[]};n.files=undefined};n.sendImport=function(){n.disableButton=!0;i({method:"POST",url:api+"/importexport/postimport",data:n.newImport,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(){f.showDialog("Import submitted successfully.");u.go("import")},function(){n.disableButton=!1;f.showDialog("Import was not submitted.",!0)})};n.imports=[];n.getImports=function(){f.getImports(n.imports.length,n.imports).then(function(t){t!==null&&(n.imports=t.value,n.groupedImports=s("groupByDate")(n.imports,"DateInserted"),n.odataInfo=t.odataInfo,f.prepCards())})};n.getImports()}]);app.controller("exportController",["$scope","$rootScope","$http","$sessionStorage","$state","appFactory","Upload","$timeout","$filter",function(n,t,i,r,u,f,e,o,s){t.User&&t.User!==null||u.go("home");n.exportmode=!0;n.impExpType=2;n.startExport=function(){f.getCarriers();f.getCountries();f.getImportExportReasons();f.getIncoTerms();f.getMots();f.getLocations(t.User.Company.CountryID)};n.startExport();n.filterCarrier=function(t){if(n.motFilter={ModeOfTransportID:n.newExport.ModeOfTransportID.toString()},t.ModeOfTransportID==="4"||t.ModeOfTransportID==="3"){n.hideCarrier=!0;t.Vessel=undefined;t.CarrierID=undefined;return}n.hideCarrier=!1};n.addNewItem=function(){n.disableAddToItems=!1;t.showWindow=!0;f.setModalOpen(!0);n.newItem={ItemDetails:[]};f.getCargos();f.getUnits();f.getStuffModes()};n.addNewItemToItems=function(){(n.validateItemDetails(),n.disableAddToItems)||(n.newExport.Items.push(n.newItem),t.closeWindow())};n.initItemDetail=function(){n.newItemDetail={};n.showItemDetailEntry=!0};n.addItemDetailToItem=function(){for(var t in n.newItem.ItemDetails)if(n.newItem.ItemDetails[t].ItemNumber.toLowerCase()===n.newItemDetail.ItemNumber.toLowerCase()){n.itemDetailsMsg='Item detail already contain packing number "'+n.newItemDetail.ItemNumber+'".';n.disableAddToItems=!0;return}n.newItem.ItemDetails.push(n.newItemDetail);n.showItemDetailEntry=!1;n.disableAddToItems&&(n.disableAddToItems=!1)};n.validateItemDetails=function(){if(n.newItem.ItemDetails.length===0){n.disableAddToItems=!0;n.itemDetailsMsg="Item detail information is required.";return}if((n.newItem.CargoID==1||n.newItem.CargoID==4)&&n.newItem.Quantity<21&&n.newItem.Quantity!==n.newItem.ItemDetails.length){n.disableAddToItems=!0;n.itemDetailsMsg="You need to enter "+n.newItem.Quantity+" cargo details.";return}if((n.newItem.CargoID==1||n.newItem.CargoID==4)&&n.newItem.Quantity>20&&n.newImport.Documents.length===0){n.disableAddToItems=!0;n.itemDetailsMsg="You need to enter "+n.newItem.Quantity+" cargo details, otherwise, attach supporting documents.";return}n.disableAddToItems=!1};n.uploadFiles=function(t,i){n.existDocCount=n.newExport.Documents.length;n.files=t;n.errFiles=i;angular.forEach(t,function(t){n.existDocCount==0?(t.upload=e.upload({url:api+"/importexport/postdocument",data:{file:t}}),t.upload.then(function(i){o(function(){t.result=i.data;n.newExport.Documents.push({DocumentID:t.result})})},function(t){t.status>0&&(n.errorMsg=t.status+": "+t.data)},function(n){t.progress=Math.min(100,parseInt(100*n.loaded/n.total))})):n.existDocCount-=1})};n.removeAttachment=function(t){var r=n.files[t];i({method:"DELETE",url:api+"/importexport/deletedocument?id="+r.result});n.files.splice(t,1);n.newExport.Documents.splice(t,1)};n.removeItemDetail=function(t){n.newItem.ItemDetails.splice(t,1)};n.hideItemDetailEntry=function(){n.showItemDetailEntry=!1};n.removeItem=function(t){n.newExport.Items.splice(t,1)};n.initExport=function(){f.setIsTinValid(!0);n.disableButton=!1;n.newExport={CompanyID:t.User.Person.CompanyID,CreatedBy:t.User.Person.ID,CountryID:t.User.Company.CountryID,Export:{},Items:[],LC:{},Documents:[]};n.files=undefined};n.sendExport=function(){n.disableButton=!0;i({method:"POST",url:api+"/importexport/postexport",data:n.newExport,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(){f.showDialog("Export submitted successfully.");u.go("export")},function(){n.disableButton=!1;f.showDialog("Export was not submitted.",!0)})};n.exports=[];n.getExports=function(){var t=n.exports.length;f.getExports(n.exports.length,n.exports).then(function(t){t!==null&&(n.exports=t.value,n.groupedExports=s("groupByDate")(n.exports,"DateInserted"),n.odataInfo=t.odataInfo,f.prepCards())})};n.getExports()}]);app.controller("importExportCtrl",["$scope","$rootScope","$http","$state","$filter","appFactory",function(n,t,i,r,u,f){t.User&&t.User!==null||r.go("home");n.searchImports=function(t){n.searchText!==undefined&&n.searchText!==""&&(t&&(n.imports=[],n.groupedImports=[]),f.getImports(n.imports.length,n.imports,n.searchText).then(function(t){t!==null&&(n.imports=t.value,n.groupedImports=u("groupByDate")(n.imports,"DateInserted"),n.odataInfo=t.odataInfo,f.prepCards())}))};n.searchExports=function(t){n.searchText!==undefined&&n.searchText!==""&&(t&&(n.exports=[],n.groupedExports=[]),f.getExports(n.exports.length,n.exports,n.searchText).then(function(t){t!==null&&(n.exports=t.value,n.odataInfo=t.odataInfo,n.groupedExports=u("groupByDate")(n.exports,"DateInserted"),f.prepCards())}))};n.markAsDone=function(t,r,u){if(n.invalidOperation(t))return!1;i({method:"GET",url:api+"/importexport/importexportmarkasdone?id="+t.ID,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(){n.exports===undefined?n.groupedImports[r].value[u].Completed=!0:n.groupedExports[r].value[u].Completed=!0},function(n){switch(n.data.Message){case"ERROR_STATUS_NOT_DELIVERED":f.showDialog("Cargo status must be delivered to mark as done.",!0);break;case"ERROR_STATUS_NOT_LOADED":f.showDialog("Cargo status must be loaded to mark as done.",!0);break;case"ERROR_PROBLEM_NOT_RESOLVED":f.showDialog("Unresolved problem exist. Close all problems to mark as done.",!0)}})};n.terminateImportExport=function(r,u,e){if(n.invalidOperation(r))return!1;i({method:"POST",url:api+"/importexport/importexportterminate",data:{ID:r.ID,Token:t.User.Login.Token},headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(){n.exports===undefined?n.groupedImports[u].value[e].Terminated=!0:n.groupedExports[u].value[e].Terminated=!0;f.showDialog("Document moved to Trash.")},function(t){if(t.status===-1)f.showDialog("Connection Broken.<br><br>Check your internet cable or WiFi.",!0);else switch(t.data.Message){case"ERROR_DATA_NOTFOUND":f.showDialog("The document does not exist.<br>Make sure you are connected to the internet by refreshing this page.",!0);break;case"ERROR_USER_INVALID_TOKEN":default:f.showDialog("Your session has been terminated due to invalid authentication.",!0);n.logout()}})};n.ieStatues=[];n.problem={add:function(){n.problem.newProblem={Messages:[],ImportExportID:n.problem.importExport.ID};n.problem.showFilters=!0;f.getProblems()},closeWindow:function(){n.problem.openWindow=!1;f.setModalOpen(!1)},data:[],getProblems:function(t){n.problem.openWindow=!0;f.setModalOpen(!0);n.problem.importExport=t;i({method:"GET",url:api+"/importexport/getproblemupdates/"+t.ID,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(t){n.problem.data=t.data})},hideFilters:function(){n.problem.showFilters=!1},importExport:{},newProblem:{},openWindow:!1,resolve:function(t){i({method:"PUT",url:api+"/importexport/putproblemupdateresolve",data:t,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(i){t.IsResolved=!0;t.ResolvedDate=i.data.ResolvedDate;n.problem.importExport.ProblemsUnresolved--})},"delete":function(r){i({method:"DELETE",url:api+"/importexport/deleteproblemupdate",data:{ID:r.ID,Token:t.User.Login.Token},headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(){n.problem.data.splice(0,1);n.problem.importExport.ProblemsUnresolved>0&&n.problem.importExport.ProblemsUnresolved--;f.showDialog("Problem <b>"+r.ProblemName+"<\/b> deleted successfully")},function(){f.showDialog("Unable to delete problem.",!0)})},save:function(){i({method:"POST",url:api+"/importexport/postproblemupdate",data:n.problem.newProblem,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(t){n.problem.showFilters=!1;n.problem.data=t.data;n.problem.importExport.ProblemsUnresolved++})},showFilters:!1};n.status={add:function(){n.status.message=undefined;n.status.newStatus={ImportExportID:n.status.importExport.ID};n.status.showFilters=!0;f.getLocations(t.User.Company.CountryID);f.loadStatuses()},closeWindow:function(){n.status.openWindow=!1;f.setModalOpen(!1)},data:[],getStatuses:function(t){n.status.openWindow=!0;f.setModalOpen(!0);n.status.importExport=t;i({method:"GET",url:api+"/importexport/getstatusupdates/"+t.ID,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(t){n.status.data=t.data})},hideFilters:function(){n.status.showFilters=!1},importExport:{},newStatus:{},openWindow:!1,"delete":function(r){i({method:"DELETE",url:api+"/importexport/deletestatusupdate",data:{ID:r,Token:t.User.Login.Token},headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(){n.status.data.splice(0,1);f.showDialog("Status deleted successfully")},function(){f.showDialog("Unable to delete status.",!0)})},save:function(){var t,r,f;n.validStatus=!0;t=n.status.newStatus.StatusID;for(r in n.status.data)if(n.status.data[r].StatusText===t.Description){n.status.message='Status "'+t.Description+'" already exists.';n.validStatus=!1;break}if(n.status.data.length>0&&n.validStatus){var u=new Date(n.status.data[0].StatusDate).toDateString(),e=new Date(n.status.newStatus.StatusDate).toDateString(),o=new Date(e)-new Date(u);o<0&&(n.status.message='Status date cannot be less than "'+u+'"',n.validStatus=!1)}if((n.status.data.length>0&&n.validStatus||n.status.data[0]!==undefined&&n.status.data[0].Abbr==="CD2")&&n.impExpType===1){f=n.status.data[0];switch(f.Abbr){case"CLD":t.Abbr!="VOY"&&(n.status.message='Status "On Voyage" is required.',n.validStatus=!1);break;case"VOY":t.Abbr!="CDC"&&(n.status.message='Status "Cargo Discharged" is required.',n.validStatus=!1);break;case"CDC":t.Abbr!="UCC"&&(n.status.message='Status "Under Custom Clearance" is required.',n.validStatus=!1);break;case"UCC":t.Abbr!="UPC"&&(n.status.message='Status "Under Port Clearance" is required.',n.validStatus=!1);break;case"UPC":t.Abbr!="CRL"&&(n.status.message='Status "Cargo Ready for Loading" is required.',n.validStatus=!1);break;case"CRL":t.Abbr!="CD1"&&(n.status.message='Status "Cargo Dispatched" is required.',n.validStatus=!1);break;case"CD1":if(t.Abbr=="CD2")break;t.Abbr!="DRY"&&(n.status.message='Status "At Dry Port" or "Cargo Delivered" is required.',n.validStatus=!1);break;case"CD2":n.status.message="Cargo is delivered. You should mark the document as completed.";n.validStatus=!1;break;case"DRY":t.Abbr!="UC1"&&(n.status.message='Status "Under Custom Inspection" is required.',n.validStatus=!1);break;case"UC1":t.Abbr!="CD2"&&(n.status.message='Status "Cargo Delivered" is required.',n.validStatus=!1)}}n.validStatus&&(n.status.newStatus.StatusID=t.ID,i({method:"POST",url:api+"/importexport/poststatusupdate",data:n.status.newStatus,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(t){n.status.showFilters=!1;n.status.data=t.data}))},showFilters:!1};n.preview={"export":{openWindow:!1,data:{},show:function(t){(t.Documents===undefined||t.Documents===null)&&f.getImportExportDocs(t.ID).then(function(n){n.status===200&&(t.Documents=n.data)});n.preview.export.data=t;n.preview.export.openWindow=!0;f.setModalOpen(!0)},closeWindow:function(){n.preview.export.data={};n.preview.export.openWindow=!1;f.setModalOpen(!1)}},"import":{openWindow:!1,data:{},show:function(t){(t.Documents===undefined||t.Documents===null)&&f.getImportExportDocs(t.ID).then(function(n){n.status===200&&(t.Documents=n.data)});n.preview.import.data=t;n.preview.import.openWindow=!0;f.setModalOpen(!0)},closeWindow:function(){n.preview.import.data={};n.preview.import.openWindow=!1;f.setModalOpen(!1)}}};n.isNotFF=t.User.Company.CompanyTypeID!==5?!0:!1;n.consigneeInfo={data:{},dataRef:{},message:"",openWindow:!1,closeWindow:function(){n.consigneeInfo.openWindow=!1;f.setModalOpen(!1)},linkTinToBill:function(){(n.consigneeInfo.data.Consignee.TIN!==""||n.consigneeInfo.data.Consignee.TIN!==null)&&f.linkTinToBill(n.consigneeInfo.data.Consignee).then(function(t){if(t===null){n.consigneeInfo.message="TIN does not exist in the system.";f.showDialog(n.consigneeInfo.message,!0);return}n.consigneeInfo.data.Consignee.CompanyName=n.consigneeInfo.dataRef.Consignee.CompanyName=t.CompanyName;n.consigneeInfo.data.Consignee.TIN=n.consigneeInfo.dataRef.Consignee.TIN=t.TIN;n.consigneeInfo.message="TIN updated successfully.";f.showDialog(n.consigneeInfo.message)})},save:function(){n.consigneeInfo.data.LC===undefined&&(n.consigneeInfo.data.LC={});n.consigneeInfo.data.LC.ImportExportID=n.consigneeInfo.data.Consignee.ImportExportID;f.saveLc(n.consigneeInfo.data.LC).then(function(t){n.consigneeInfo.message="LC updated successfully.";t===null?f.showDialog("Failed to update LC.",!0):(f.showDialog(n.consigneeInfo.message),n.consigneeInfo.data.LC=n.consigneeInfo.dataRef.LC=t.data);n.consigneeInfo.linkTinToBill()})},show:function(t){if(n.isNotFF){n.invalidOperation();return}n.consigneeInfo.data=angular.copy(t);n.consigneeInfo.dataRef=t;n.consigneeInfo.message="";n.consigneeInfo.openWindow=!0;f.setModalOpen(!0)}};n.costInfo={openWindow:!1,data:{},dataRef:{},closeWindow:function(){n.costInfo.openWindow=!1;f.setModalOpen(!1)},save:function(){n.costInfo.data.Cost.ImportExportID=n.costInfo.data.ID;n.costInfo.data.Cost.BaseCurrency=t.exRates.base;f.saveCostInfo(n.costInfo.data.Cost).then(function(t){if(t==null){n.costInfo.message="Oops! failed to update";return}(isNaN(n.costInfo.data.Cost.ID)||n.costInfo.data.Cost.ID===0)&&(n.costInfo.data.Cost.ID=t);f.showDialog("Cost updated successfully.");n.exports===undefined?n.imports[n.costInfo.dataIndex].Cost=n.costInfo.data.Cost:n.exports[n.costInfo.dataIndex].Cost=n.costInfo.data.Cost})},show:function(t){if(n.invalidOperation(t))return!1;(t.Cost===undefined||t.Cost===null)&&(t.Cost={});n.originalData=n.exports===undefined?n.imports:n.exports;for(var i in n.originalData)if(n.originalData[i].ID==t.ID){n.originalIndex=i;break}n.costInfo.data=angular.copy(t);n.costInfo.dataIndex=n.originalIndex;n.costInfo.dataRef=t;n.costInfo.message="";n.costInfo.openWindow=!0;f.setModalOpen(!0)}};n.invalidOperation=function(t){return n.isNotFF||t.Completed||t.Terminated?(f.showDialog("Invalid operation!<br />You cannot make changes.",!0),!0):!1};t.exRates===undefined&&f.getExRate().done(function(){})}]);app.controller("maritimeController",["$scope","$rootScope","$http","$state","appFactory",function(n,t,i,r){(t.User===undefined||t.User.Company===undefined||t.User.Company.CompanyTypeID!==99)&&r.go("home")}]);app.controller("createCompanyCtrl",["$scope","$rootScope","$sessionStorage","$http","$state","appFactory",function(n,t,i,r,u,f){n._userToken=t.User===undefined?"":t.User.Login.Token;n.newCompany={Company:{},Login:{Token:n._userToken},Person:{}};n.disableButton=!1;n.saveNewCompany=function(){n.newCompany.Company.CompanyTypeID=6;n.disableButton=!0;r({method:"POST",url:api+"/account/postcompany",headers:{"Content-Type":"application/json"},data:n.newCompany}).then(function(){n.message="Company created successfully.";f.showDialog("Company created successfully.");setTimeout(function(){u.go("login")},2e3)},function(t){switch(t.status){case 409:f.showDialog("Company name or TIN already exists.",!0);break;default:switch(t.data.Message){case"ERROR_EMAIL_CONFLICT":f.showDialog("Company not registered.<br><br><b>Email already exists.<\/b>",!0);break;default:f.showDialog("Oops! Something went wrong.",!0)}}n.disableButton=!1})};f.getCountries();f.getCompanyTypes()}]);app.controller("createConsigneeCtrl",["$scope","$rootScope","$sessionStorage","$http","$state",function(n){n.disableCompanyType=!0;n.consigneeCompany={ID:6}}]);app.controller("accountCtrl",["$scope","$rootScope","$sessionStorage","$http","$state","appFactory",function(n,t,i,r,u,f){t.User&&t.User!=null||u.go("home");n.getIsActiveIcon=function(n){return f.getActiveIcon(n)};n.doesServiceExist=function(t){if(n.account.subscription.data===undefined||n.account.subscription.data.length===0)return!1;for(var i in n.account.subscription.data)if(n.account.subscription.data[i].SubscriptionName.match(t))return!0;return!1};n.account={password:{change:function(){n.account.password.openWindow=!0;f.setModalOpen(!0)},closeWindow:function(){n.account.password.openWindow=!1;f.setModalOpen(!1)},data:{ID:t.User.Login.ID,Token:t.User.Login.Token},openWindow:!1,save:function(){r({method:"PUT",url:api+"/account/changepassword",data:n.account.password.data,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(){n.account.password.closeWindow();t.User.Login.LastPasswordChange=new Date;i.__user=t.User;f.showDialog("Password changed successfully.")},function(){f.showDialog("Failed to change password.",!0)})}},profile:{data:{},edit:function(){n.account.profile.editEnabled=!0;n.account.profile.data=angular.copy(t.User.Person)},editEnabled:!1,save:function(){n.account.profile.editEnabled=!1;r({method:"PUT",url:api+"/account/putperson",data:n.account.profile.data,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(n){i.__user.Person=t.User.Person=n.data})}},subscription:{data:[],get:function(){f.getSubscriptionTypes();f.getCompanySubscriptions(t.User.Company.ID).then(function(t){n.account.subscription.data=t})},set:function(i){if(n.serviceInCategory&&(i=n.serviceInCategory.service),n.account.subscription.data===undefined||n.account.subscription.data.length===0||n.serviceInCategory!==undefined&&t.confirmMode)t.closeDialog(),f.setCompanySubscriptions({CompanyID:t.User.Company.ID,SubcriptionTypeID:i.ID}).then(function(t){if(n.serviceInCategory=undefined,t.status===200)n.account.subscription.get(),f.showDialog("Subscription activated successfully.");else{if(t.data.Message){f.showDialog("Subscription already exists.",!0);return}f.showDialog("Unable to activate Subscription.",!0)}});else for(var r in n.account.subscription.data)if(n.account.subscription.data[r].Category.match(i.Category)&&n.account.subscription.data[r].IsActive){f.showDialog("Changing subscription to <b>"+i.SubscriptionName+"<\/b> would deactivate <b>"+n.account.subscription.data[r].SubscriptionName+"<\/b>.<br/>Do you agree to this change?",null,!0,n.account.subscription.set);n.serviceInCategory={service:i};break}}},company:{data:{},edit:function(){n.account.company.editEnabled=!0;n.account.company.data=angular.copy(t.User.Company)},editEnabled:!1,save:function(){n.account.company.editEnabled=!1;r({method:"PUT",url:api+"/account/putcompany",data:n.account.company.data,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(n){i.__user.Company=t.User.Company=n.data})}},users:{changeIsActiveState:function(t){r({method:"PUT",url:api+"/account/lockorunlockuser",data:n.account.users.data[t],headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(i){n.account.users.data[t]=i.data})},add:function(){n.account.users.newUserEnabled=!0;n.account.roles.getRoles();n.Person={CompanyID:t.User.Company.ID};n.Login={IsActive:!0};n.message=undefined},closeWindow:function(){n.account.users.newUserEnabled=!1},data:{},edit:function(){},editEnabled:!1,getUsers:function(){r({method:"POST",url:api+"/account/getusersincompany",data:t.User.Login,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(t){n.account.users.data=t.data})},newUserEnabled:!1,save:function(){n.account.users.newUserEnabled=!1;n.Login.Token=t.User.Login.Token;n.newUser={Login:n.Login,Person:n.Person};r({method:"POST",url:api+"/account/postpersonforcompany",data:n.newUser,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(){n.account.users.getUsers()},function(n){switch(n.status){case 400:f.showDialog("Oops! You are unable to create a new user because your have used up your subscription limit. Upgrade to a higher package to enjoy additional benefits.",!0);break;case 404:f.showDialog("Oops! You are unable to create a new user because your have no active subscription.",!0)}})}},roles:{add:function(){n.account.roles.newRoleEnabled=!0;n.account.roles.getRoles();n.role={CompanyID:t.User.Company.ID};n.rolePermission={};n.message=undefined},closeWindow:function(){n.account.roles.newRoleEnabled=!1},data:{},getRoles:function(){r({method:"POST",url:api+"/account/getrolesincompany",data:t.User.Login,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(t){n.account.roles.data=t.data})},newRoleEnabled:!1,save:function(){n.account.roles.newRoleEnabled=!1;n.newRole={Role:n.role,RolePermission:n.rolePermission,Token:t.User.Login.Token};r({method:"POST",url:api+"/account/postroleandpermission",data:n.newRole,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(){},function(n){switch(n.status){case 400:f.showDialog("Oops! You are unable to create a new role because your have used up your subscription limit. Upgrade to a higher package to enjoy additional benefits.",!0);break;case 404:f.showDialog("Oops! You are unable to create a new role because your have no active subscription.",!0)}})}}};n.account.subscription.get();(t.User.Login.LastSeen===null||t.User.Login.LastPasswordChange===null)&&(n.message="To secure your account, kindly change your password.",n.account.password.change())}]);app.controller("adminCtrl",["$scope","$rootScope","$http","$state",function(n,t,i,r){t.User&&t.User!=null||r.go("home");i({method:"POST",url:api+"/account/getuserperm",data:t.User.Login,headers:{"Content-Type":"application/json"}}).then(function(t){n.perms=t.data;n.perms.EditUser==!1&&r.go("home")})}]);app.controller("accountAdminCtrl",["$scope","$rootScope","$sessionStorage","$http","$state",function(n){n.account.users.getUsers()}]);app.controller("nationalBankCtrl",["$scope","$rootScope","$sessionStorage","$http","$state","appFactory",function(n,t,i,r,u,f){t.User.Company.CompanyTypeID!==101&&u.go("home");n.tinOrLcData=[];n.getImportExportByTinOrLc=function(i){n.searchText!==undefined&&n.searchText!==""&&(t.loader=!0,f.setModalOpen(!0),f.getImportExportByTinOrLc(n.tinOrLcData,n.searchText,i).then(function(i){i!==null&&(n.tinOrLcData=i.value,n.odataInfo=i.odataInfo,f.prepCards());f.setModalOpen(!1);t.loader=!1}))}}]);app.controller("consigneeCtrl",["$scope","$rootScope","$sessionStorage","$http","$state","appFactory",function(n,t,i,r,u,f){t.User.Company.CompanyTypeID!==6&&u.go("home");n.tinOrLcData=[];n.getImportExportByTinOrLc=function(i){i&&(n.searchText===undefined||n.searchText==="")||(t.loader=!0,f.setModalOpen(!0),f.getImportExportByTinOrLc(n.tinOrLcData,n.searchText,i).then(function(i){i!==null&&(n.tinOrLcData=i.value,n.odataInfo=i.odataInfo,f.prepCards());f.setModalOpen(!1);t.loader=!1}))};n.getImportExportByTinOrLc()}]);app.controller("reportController",["$scope","$rootScope","$sessionStorage","$http","$state","$filter","groupByFactory","appFactory",function(n,t,i,r,u,f,e,o){t.User&&t.User!=null||u.go("home");n.report={data:[],filter:{name:{},Token:t.User.Login.Token},groupBy:"",generate:function(){t.loader=!0;o.setModalOpen(!0);n.report.data=[];n.report.groupBy="";u.go("report");n.report.filter.ReportName=n.report.filter.name.value;r({method:"POST",url:api+"/reports/generatereport",data:n.report.filter,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(i){let r=i.data.Table?i.data.Table:i.data;n.report.data=r;u.go("report."+n.report.filter.name.value);t.loader=!1;o.setModalOpen(!1)},function(){t.loader=!1;o.setModalOpen(!1)})},getTotal:function(t,i){n.total=0;for(var r in t)if(t[r][i]!==undefined)n.total+=t[r][i];else break;return n.total},list:[{value:"bill_statuses_grouped_by_tin_report",label:"Bill Statuses By Forwarder"},{value:"cargo_dispatched_weight_grouped_by_month_report",label:"Cargo Dispatched Weight By Months"},{value:"cargo_import_weight_grouped_by_tin_report",label:"Cargo Import Weight By Forwarder"},{value:"cargo_on_voyage_only_grouped_by_country_report",label:"Cargo On Voyage Only By Country"},{value:"problem_grouped_by_tin_report",label:"Problems By Forwarder"},{value:"problem_grouped_by_tin_unresolved_report",label:"Problems By Forwarder Unresolved"},{value:"demurrage_grouped_by_tin_report",label:"Demurrage By Forwarder"},{value:"demurrage_grouped_by_tin_active_report",label:"Demurrage By Forwarder Active"},{value:"transit_time_grouped_by_import_report",label:"Transit Time By Bill Of Lading"},{value:"transit_time_grouped_by_country_report",label:"Transit Time By Country Detailed"},{value:"transit_time_grouped_by_country_summary_report",label:"Transit Time By Country Summary"},{value:"transit_time_grouped_by_tin_report",label:"Transit Time By Forwarder"},],loadView:function(){n.report.data=[];u.go("report")},isActiveClass:function(n){return n?"status-icon bg-green":"status-icon bg-red"}}}]);app.controller("reportCustomCtrl",["$scope","$rootScope","$http","$state","$sessionStorage","appFactory",function(n,t,i,r,u,f){t.User==undefined&&r.go("login");n.formData={ReportName:"",CompanyID:t.User.Company.ID,Queries:[],ConfigStatsTimes:u.configStatsTimes};n.message="";n.dbTables=null;n.tableColumns=[];n.column={};n.mapIsHidden=!0;n.controlHidden=!0;n.isFirstClause=!0;n.reportQuery=null;n.customReport=[];n.customReportHeaders=[];n.currentColumnMapping={};n.initCustomReportQuery=function(){n.customReportQuery={Queries:[],CompanyTypeID:t.User.Company.CompanyTypeID,CompanyID:t.User.Company.ID}};n.getCustomReportHeaders=function(){i({method:"GET",url:api+"/reports/ColumnHeaders",headers:{"Content-Type":"application/json"}}).then(function(t){n.customReportHeaders=t.data})};n.initCustomReportQuery();n.getCustomReportHeaders();n.refillColumns=function(){if(n.customReportHeaders.length===0&&n.getCustomReportHeaders(),n.currentColumnMapping!==null&&n.currentColumnMapping!==undefined&&n.currentColumnMapping.MappingModelParams!==undefined){n.tableColumns=[];for(var t=0;t<n.currentColumnMapping.MappingModelParams.length;t++)n.getTableColumns(n.currentColumnMapping.MappingModelParams[t].TableName,t)}};n.getTableColumns=function(t,r){i({method:"GET",url:api+"/reports/Columns?tableName="+t,headers:{"Content-Type":"application/json"}}).then(function(t){n.tableColumns[r]=t.data})};n.getDBTables=function(t){if(n.customReport=[],t===null||t===undefined||t.Name===undefined){n.currentColumnMapping={ColumnMappings:[],MappingModelParams:[]};for(var r in n.customReportHeaders){if(r<5){n.currentColumnMapping.ColumnMappings.push(!0);continue}n.currentColumnMapping.ColumnMappings.push(!1)}}else n.currentColumnMapping=t;n.dbTables===null?i({method:"GET",url:api+"/reports/Tables",headers:{"Content-Type":"application/json"}}).then(function(t){n.dbTables=t.data;n.refillColumns()}):n.refillColumns()};n.addNewQuery=function(){(n.currentColumnMapping===null||n.currentColumnMapping===undefined||n.currentColumnMapping.MappingModelParams===undefined)&&n.getDBTables(n.currentColumnMapping);n.currentColumnMapping.MappingModelParams.push({})};n.rptQueryBuilder=function(t,i,r,u,f){return n.reportQuery!=null&&(n.isFirstClause=!1),t==undefined&&(t=""),f==undefined&&(f=""),n.reportQuery=u=="LIKE"?" "+t+" "+i+"."+r+" "+u+" '%"+f+"%'":" "+t+" "+i+"."+r+" "+u+" '"+f+"'",n.reportQuery};n.resetQuery=function(){n.isFirstClause=!0;n.reportQuery=null;n.mappingStatusMessage=undefined;n.initCustomReportQuery()};n.resetAllQuery=function(){n.currentColumnMapping=null;n.resetQuery()};n.submitQuery=function(){var r,t;for(n.mappingStatusMessage=undefined,r=n.currentColumnMapping.MappingModelParams,t=0;t<r.length;t++)n.customReportQuery.Queries.push(n.rptQueryBuilder(r[t].Lop,r[t].TableName,r[t].ColumnName,r[t].Op,r[t].Val));i({method:"POST",url:api+"/reports/Custom",data:n.customReportQuery,cache:!1,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(t){n.customReport=t.data},function(){n.customReport=[]});n.resetQuery()};n.hideMapping=function(){f.setModalOpen(!1);n.mapIsHidden=!0};n.showMappingView=function(){f.setModalOpen(!0);n.controlHidden=!1;n.mapIsHidden=!n.mapIsHidden;n.getDBTables(n.currentColumnMapping)}}])}(),function(){app.controller("uploadCtrl",["$scope","$rootScope","$state","appFactory","Upload","$timeout",function(n,t,i,r,u,f){r.setModalOpen(!0);n.closeWindow=function(){r.setModalOpen(!1);i.go("account")};n.upload=function(i,r){u.upload({url:api+"/account/PostProfilePhoto",data:{file:u.dataUrltoBlob(i,r),personId:t.User.Person.ID}}).then(function(){f(function(){t.User.Person.PhotoDataUrl=i})},function(t){t.status>0&&(n.errorMsg=t.status+": "+t.data)},function(t){n.progress=parseInt(100*t.loaded/t.total)})}}])}();app.controller("datepickerPopupController",["$scope","uibDateParser","datepickerProvider",function(n,t,i){function f(t){var f=t.date,e=t.mode,r,i,u;if(e==="day")for(r=new Date(f).setHours(0,0,0,0),i=0;i<n.events.length;i++)if(u=new Date(n.events[i].date).setHours(0,0,0,0),r===u)return n.events[i].status;return""}var r,u;n.dateOptions=i.getDateOptions();n.required=!1;n.today=function(){n.dt=new Date};n.clear=function(){n.dt=null};n.inlineOptions={customClass:f,minDate:new Date,showWeeks:!0};n.toggleMin=function(){n.inlineOptions.minDate=n.inlineOptions.minDate?new Date:null;n.dateOptions.minDate=n.inlineOptions.minDate};n.openDt=function(){n.popupDt.opened=!0};n.popupDt={opened:!1};n.setDate=function(t,i,r){n.dt=new Date(t,i,r)};n.setDate2=function(t){return n.dt=new Date(t)};n.formats=i.getFormats();n.format=n.formats[0];n.altInputFormats=i.getFormats();r=new Date;r.setDate(r.getDate()+1);u=new Date;u.setDate(r.getDate()+1);n.events=[{date:r,status:"full"},{date:u,status:"partially"}]}]);app.controller("timepickerController",["$scope","$log",function(n,t){n.mytime=new Date;n.hstep=1;n.mstep=5;n.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]};n.ismeridian=!0;n.toggleMode=function(){n.ismeridian=!n.ismeridian};n.update=function(){var t=new Date;t.setHours(14);t.setMinutes(0);n.mytime=t};n.changed=function(){t.log("Time changed to: "+n.mytime)};n.clear=function(){n.mytime=null}}]),function(){app.directive("dirMenuTop",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/menu_top.html"}});app.directive("dirAddItem",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/add_item_fullscreen.html"}});app.directive("dirPasswordChange",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/passwordchange.html"}});app.directive("dirNationalBankSearch",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/dashboard_bank_search_view.html",controller:"nationalBankCtrl"}});app.directive("dirConsigneeView",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/dashboard_consignee_data_view.html",controller:"consigneeCtrl"}});app.directive("dirTinOrLcData",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/tin_or_lc_data.html"}});app.directive("dirOptionsMoreWindow",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/options_more_window.html"}});app.directive("dirExportSummary",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/export_summary.html"}});app.directive("dirImportSummary",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/import_summary.html"}});app.directive("dirCreateCompany",function(){return{restrict:"E",transclude:!0,controller:"createCompanyCtrl",templateUrl:"views/directives/create_company.html"}});app.directive("dirForwarderUpdateConsigneeView",function(){return{restrict:"E",transclude:!0,controller:"importExportCtrl",templateUrl:"views/directives/ff_update_consignee_view.html"}});app.directive("dirImportExportUpdateCostView",function(){return{restrict:"E",transclude:!0,controller:"importExportCtrl",templateUrl:"views/directives/importexport_update_cost_view.html"}});app.directive("dirImportView",function(){return{require:"importController",restrict:"E",transclude:!0,controller:"importExportCtrl",templateUrl:"views/directives/imports_view.html"}});app.directive("dirImportToolbox",function(){return{restrict:"EA",transclude:!0,templateUrl:"views/directives/import_toolbox.html"}});app.directive("dirImportBillPreview",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/import_bill_preview.html"}});app.directive("dirExportView",function(){return{require:"exportController",restrict:"E",transclude:!0,controller:"importExportCtrl",templateUrl:"views/directives/exports_view.html"}});app.directive("dirExportToolbox",function(){return{restrict:"EA",transclude:!0,templateUrl:"views/directives/export_toolbox.html"}});app.directive("dirExportBillPreview",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/export_bill_preview.html"}});app.directive("dirStatusUpdateView",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/status_update_view.html"}});app.directive("dirProblemUpdateView",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/problem_update_view.html"}});app.directive("dirUserProfileView",function(){return{controller:"accountCtrl",restrict:"E",transclude:!0,templateUrl:"views/directives/account_user_profile_view.html"}});app.directive("dirUserLinks",["$http","$rootScope",function(n,t){return{restrict:"E",transclude:!0,template:'<ng-include src="tmpl"/>',controller:"accountCtrl",scope:"=",compile:function(){return{pre:function(n){n.tmpl="views/directives/account_menu_view_user.html"},post:function(i){n({method:"POST",url:api+"/account/getuserperm",data:t.User.Login,headers:{"Content-Type":"application/json"}}).then(function(n){i.perms=n.data;i.perms.EditUser===!0&&(i.tmpl="views/directives/account_menu_view_admin.html")})}}}}}]);app.directive("dirManageUsers",function(){return{require:"accountCtrl",restrict:"E",transclude:!0,templateUrl:"views/directives/account_manage_users_view.html",controller:"accountAdminCtrl"}});app.directive("dirDialogWindow",function(){return{restrict:"E",transclude:!0,templateUrl:"views/directives/dialog_window.html"}});app.directive("dirRolePermissions",["$http","$rootScope",function(n,t){return{restrict:"E",transclude:!0,template:'<ng-include src="tmpl"/>',scope:"=",compile:function(){return{pre:function(n){n.tmpl="views/directives/account_role_perm_user.html"},post:function(i){n({method:"POST",url:api+"/account/getuserperm",data:t.User.Login,headers:{"Content-Type":"application/json"}}).then(function(n){i.perms=n.data;i.perms.EditFF===!0&&i.perms.EditSA===!0?i.tmpl="views/directives/account_role_perm_sa_ff.html":i.perms.EditSA===!0?i.tmpl="views/directives/account_role_perm_sa.html":i.perms.EditAdmin===!0&&(i.tmpl="views/directives/account_role_perm_admin.html")})}}}}}]);app.directive("dirDashboardData",["$rootScope",function(n){return{restrict:"E",transclude:!0,template:'<ng-include src="tmpl"/>',compile:function(){return{post:function(t){switch(n.User.Company.CompanyTypeID){case 4:t.tmpl="views/directives/dashboard_cc.html";break;case 5:t.tmpl="views/directives/dashboard_ff.html";break;case 6:t.tmpl="views/directives/dashboard_consignee.html";break;case 99:t.tmpl="views/directives/dashboard_maritime.html";break;case 101:t.tmpl="views/directives/dashboard_bank.html";break;case 102:t.tmpl="views/directives/dashboard_customs.html"}}}}}}]);app.directive("stringToNumber",function(){return{require:"ngModel",link:function(n,t,i,r){r.$parsers.push(function(n){return""+n});r.$formatters.push(function(n){return parseFloat(n)})}}});app.directive("renderNameFor",["$rootScope",function(n){return{restrict:"A",link:function(t,i,r){var u=undefined,f;if(n.mots)for(f in n.mots)if(r.renderNameFor!==""&&r.renderNameFor===n.mots[f].ID.toString()){u=n.mots[f];break}if(u!==undefined)switch(u.Mode.toLowerCase()){case"air":r.i18n="_AirWayBill_";break;default:r.i18n="_TruckWayBill_"}}}}]);app.directive("datepickerFrom",["$parse",function(n){return{restrict:"A",link:function(t,i,r){function f(n){var t;try{t=$.datepicker.parseDate(u,n.value)}catch(i){t=null}return t}$(i).datepicker({defaultDate:"",changeMonth:!0,changeYear:!0,numberOfMonths:1}).on("change",function(){$("#ToDate").datepicker("option","minDate",f(this));dateVal=this.value;t.$apply(function(){n(r.ngModel).assign(t,dateVal)})});t.$on("$destroy",function(){i.off()});var u="mm/dd/yy"}}}]);app.directive("datepickerTo",["$parse",function(n){return{restrict:"A",link:function(t,i,r){function f(n){var t;try{t=$.datepicker.parseDate(u,n.value)}catch(i){t=null}return t}$(i).datepicker({defaultDate:"",changeMonth:!0,changeYear:!0,numberOfMonths:1}).on("change",function(){$("#FromDate").datepicker("option","maxDate",f(this));dateVal=this.value;t.$apply(function(){n(r.ngModel).assign(t,dateVal)})});t.$on("$destroy",function(){i.off()});var u="mm/dd/yy"}}}]);app.directive("autoComplete",["$parse","autoCompleteDataService",function(n,t){return{restrict:"A",link:function(i,r,u){$(r).autocomplete({source:t.getSource(u.source,u.extraparams),minLength:2,delay:500,classes:{"ui-autocomplete":"highlight"},select:function(t,r){i.$apply(function(){n(u.ngModel).assign(i,r.item.value)})}})}}}]);app.directive("rptFilterDate",function(){return{restrict:"E",templateUrl:"views/reports/filters/rpt_filter_date.html"}});app.directive("rptFilterDateTin",function(){return{restrict:"E",templateUrl:"views/reports/filters/rpt_filter_date_tin.html"}});app.directive("rptFilterDateCountry",function(){return{restrict:"E",templateUrl:"views/reports/filters/rpt_filter_date_country.html"}});app.directive("rptFilterDateBill",function(){return{restrict:"E",templateUrl:"views/reports/filters/rpt_filter_date_bill.html"}});app.directive("rptFilterDateTinBill",function(){return{restrict:"E",templateUrl:"views/reports/filters/rpt_filter_date_tin_bill.html"}});app.directive("rptFilterDateTinCargo",function(){return{restrict:"E",templateUrl:"views/reports/filters/rpt_filter_date_tin_cargo.html"}});app.directive("rptFilterTinCargoCountry",function(){return{restrict:"E",templateUrl:"views/reports/filters/rpt_filter_tin_cargo_country.html"}});app.directive("rptFilterDateTinProblem",function(){return{restrict:"E",templateUrl:"views/reports/filters/rpt_filter_date_tin_problem.html"}});app.directive("rptFilterTinProblem",function(){return{restrict:"E",templateUrl:"views/reports/filters/rpt_filter_tin_problem.html"}})}(),function(){app.directive("dirDatepicker",function(){return{restrict:"AE",scope:{dt:"="},transclude:!0,templateUrl:"views/datepicker-date.html",controller:"datepickerPopupController",link:function(n,t,i){n.dateOptions.maxDate=i.maxDate&&i.maxDate==="null"?null:new Date;n.dateOptions.minDate=i.minDate&&(i.minDate!=="null"||i.minDate!==undefined)?new Date(i.minDate):null;n.required=i.required!==undefined||i.required==="true"?!0:!1}}})}();app.filter("groupByDate",function(){return function(n,t){const i=n.reduce((n,i)=>{const[f,e,u]=i[t].split("-"),r=new Date(f,e-1,u.substr(0,u.indexOf("T"))).toJSON();return n[r]?n[r].push(i):n[r]=[i],n},{});return Object.keys(i).map(n=>({key:n,value:i[n]}))}});app.filter("groupByField",function(){return function(n,t){var r=[],i=[],u,f,e;if(n!==undefined&&n.length>0&&t!==""){for(u in n)i.indexOf(n[u][t])===-1&&i.push(n[u][t]);i.sort();for(f in i){r.push([]);for(e in n)n[e][t]===i[f]&&r[f].push(n[e])}}else r=n;return r}});app.filter("numberparse",function(){return function(n){if(n===undefined||n===null||n<1e3)return n;let f=n,t=1,e=0,r="",u=1e3,h=Math.pow(u,2),c=Math.pow(u,3),o=Math.pow(u,4);while(f*t>=t*u){if(t*=u,t>o)break;f=Math.floor(n/t);e=n%t}let s=(e/t).toString(),i=s.substr(s.indexOf(".")+1,1);r=f;switch(t){case u:r+=i==="0"?"K":"."+i+"K";break;case h:r+=i==="0"?"M":"."+i+"M";break;case c:r+=i==="0"?"B":"."+i+"B";break;case o:r+=i==="0"?"T":"."+i+"T";break;default:r="999T+"}return r}});app.filter("statusavail",function(){return function(n,t){var r,i;if(n!==undefined&&n!==null){r=[];for(i in n)t===1&&(n[i].ImpExpTypeID===1||n[i].ImpExpTypeID===3)&&r.push(n[i]),t===2&&(n[i].ImpExpTypeID===2||n[i].ImpExpTypeID===3)&&r.push(n[i]);return r}}});app.filter("startFrom",function(){return function(n,t){return n?(t=+t,n.slice(t)):[]}});app.filter("carrier",["$rootScope",function(n){return function(t){for(var i in n.carriers)if(n.carriers[i].ID==t)return n.carriers[i].CarrierName}}]);app.filter("country",["$rootScope",function(n){return function(t){for(var i in n.countries)if(n.countries[i].ID==t)return n.countries[i].Name}}]);app.filter("cargo",["$rootScope",function(n){return function(t){for(var i in n.cargos)if(n.cargos[i].ID==t)return n.cargos[i].CargoName}}]);app.filter("subcargo",["$rootScope",function(n){return function(t){for(var i in n.subcargos)if(n.subcargos[i].ID==t)return n.subcargos[i].Description}}]);app.filter("danger",function(){return function(n){switch(n){case!0:return"***";default:return""}}});app.filter("resolvedtext",function(){return function(n){switch(n){case!0:return"Resolved";default:return"Pending"}}});app.filter("inco",["$rootScope",function(n){return function(t){for(var i in n.incoTerms)if(n.incoTerms[i].ID==t)return n.incoTerms[i].IncoName}}]);app.filter("location",["$rootScope",function(n){return function(t){for(var i in n.locations)if(n.locations[i].ID==t)return n.locations[i].LocationName}}]);app.filter("mot",["$rootScope",function(n){return function(t){for(var i in n.mots)if(n.mots[i].ID==t)return n.mots[i].Mode}}]);app.filter("podName",["$rootScope",function(n){return function(t){for(var i in n.pods)if(n.pods[i].ID==t)return n.pods[i].PortName}}]);app.filter("polName",["$rootScope",function(n){return function(t){for(var i in n.pols)if(n.pols[i].ID==t)return n.pols[i].PortName}}]);app.filter("reason",["$rootScope",function(n){return function(t){for(var i in n.importExportReasons)if(n.importExportReasons[i].ID==t)return n.importExportReasons[i].Reason}}]);app.filter("stuffMode",["$rootScope",function(n){return function(t){for(var i in n.stuffModes)if(n.stuffModes[i].ID==t)return n.stuffModes[i].Description}}]);app.filter("unit",["$rootScope",function(n){return function(t){for(var i in n.units)if(n.units[i].ID==t)return n.units[i].UnitName}}]);app.filter("vessel",["$rootScope",function(n){return function(t){for(var i in n.carrierVessels)if(n.carrierVessels[i].ID==t)return n.carrierVessels[i].Name}}]);app.filter("problem",function(){return function(n){for(var t=0;t<problemsList.length;t++)if(problemsList[t].ID==n)return problemsList[t].Problem}});app.filter("statusName",function(){return function(n){for(var t=0;t<statusList.length;t++)if(statusList[t].ID==n)return statusList[t].Description}});app.filter("completed",function(){return function(n){switch(n){case!1:return"_Pending_";case!0:return"_Done_"}}});app.filter("resolved",function(){return function(n){switch(n){case!1:return"N";case!0:return"Y"}}}),function(){"use strict";var n=api+"/Reports";app.directive("mappingDirective",function(){var t=["$scope","$http","$state",function(t,i){t.flgAddNewMapping=!1;t.rptCtrlWorking=!1;t.mappingStatusMessage="";t.mappingsCollection=[];t.setAddedColumnMapping=function(){t.flgAddNewMapping=!0;t.mappingStatusMessage=""};t.saveMapping=function(){t.rptCtrlWorking=!0;t.mappingStatusMessage="Saving mapping....";(t.currentColumnMapping.ColumnMappings===undefined||t.currentColumnMapping.ColumnMappings.length===0)&&(t.currentColumnMapping.ColumnMappings=[!0,!0,!0,!0,!0]);i.post(n+"/AddMapping",t.currentColumnMapping).then(function(){t.rptCtrlWorking=!1;t.mappingStatusMessage="Mapping '"+t.currentColumnMapping.Name+"' saved.";t.getMappings();t.flgAddNewMapping=!1},function(){t.mappingStatusMessage="Oops! Unable to save mapping '"+t.currentColumnMapping.Name+"'.";t.rptCtrlWorking=!1})};t.toggleCurrentMapping=function(n){t.currentColumnMapping.ColumnMappings=[];for(var i=0;i<t.customReportHeaders.length;i++)t.currentColumnMapping.ColumnMappings.push(n)};t.refreshTableColumns=function(){t.tableColumns=[];for(var n=0;n<t.currentColumnMapping.MappingModelParams.length;n++)t.tableColumns.push("")};t.getMappings=function(){i({method:"GET",url:n+"/GetMappings",headers:{"Content-Type":"application/json"}}).then(function(n){t.mappingsCollection=n.data})};t.getMappings();t.currentParamsList=[];t.addParams=function(n,i,r,u,f){var e={};e.TableName=i;e.ColumnName=r;e.Op=u;e.Lop=n;e.Val=f;e.IndexPosition=t.currentParamsList.lenth;e.Id=t.currentParamsList.length;e.MappingModelId="";t.currentParamsList.push(e)};t.resetParams=function(){t.currentParamsList=[]}}];return{restrict:"EA",controller:t,templateUrl:"templates_quarantined/common/view-dir-column-mapping.html"}}).directive("customReportsQueryBuilder",function(){return{restrict:"EA",templateUrl:"templates_quarantined/common/view-dir-custom-reports-query-builder.html"}})}();angular.module("chartjsAngular",[]).factory("chartjsFactory",function(){var t="",n={};return n.setCanvas=function(n){t=document.getElementById(n)},n.createChart=function(n,i,r){return new Chart(t,{type:n,data:i,options:r})},n}).provider("chartjsGlobalProvider",function(){this.$get=function(){return{setGlobal:function(n,t,i){Chart.defaults.global.elements[n][t]=i}}}});